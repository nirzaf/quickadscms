(function(d){var b,a,c;a=typeof window!=="undefined"&&window!==null?window:global;c="ontouchstart" in a;a.BarRating=b=(function(){function e(){this.show=function(){var i=d(this.elem),l,h,j=this.options,g,k,f=c?"touchstart":"click";if(!i.data("barrating")){if(j.initialRating){k=d('option[value="'+j.initialRating+'"]',i)}else{k=d("option:selected",i)}i.data("barrating",{currentRatingValue:k.val(),currentRatingText:k.text(),originalRatingValue:k.val(),originalRatingText:k.text()});l=d("<div />",{"class":"br-widget"}).insertAfter(i);i.find("option").each(function(){var p,o,n,m;p=d(this).val();if(p){o=d(this).text();n=d("<a />",{href:"#","data-rating-value":p,"data-rating-text":o});m=d("<span />",{text:(j.showValues)?o:""});l.append(n.append(m))}});if(j.showSelectedRating){l.append(d("<div />",{text:"","class":"br-current-rating"}))}i.data("barrating").deselectable=(!i.find("option:first").val())?true:false;if(j.reverse){g="nextAll"}else{g="prevAll"}if(j.reverse){l.addClass("br-reverse")}if(j.readonly){l.addClass("br-readonly")}l.on("ratingchange",function(m,n,o){n=n?n:i.data("barrating").currentRatingValue;o=o?o:i.data("barrating").currentRatingText;i.find('option[value="'+n+'"]').prop("selected",true);if(j.showSelectedRating){d(this).find(".br-current-rating").text(o)}}).trigger("ratingchange");l.on("updaterating",function(m){d(this).find('a[data-rating-value="'+i.data("barrating").currentRatingValue+'"]').addClass("br-selected br-current")[g]().addClass("br-selected")}).trigger("updaterating");h=l.find("a");if(c||j.readonly){h.on("click",function(m){m.preventDefault()})}if(!j.readonly){h.on(f,function(m){var o=d(this),n,p;m.preventDefault();h.removeClass("br-active br-selected");o.addClass("br-selected")[g]().addClass("br-selected");n=o.attr("data-rating-value");p=o.attr("data-rating-text");if(o.hasClass("br-current")&&i.data("barrating").deselectable){o.removeClass("br-selected br-current")[g]().removeClass("br-selected br-current");n="",p=""}else{h.removeClass("br-current");o.addClass("br-current")}i.data("barrating").currentRatingValue=n;i.data("barrating").currentRatingText=p;l.trigger("ratingchange");j.onSelect.call(this,i.data("barrating").currentRatingValue,i.data("barrating").currentRatingText);return false});if(!c){h.on({mouseenter:function(){var m=d(this);h.removeClass("br-active").removeClass("br-selected");m.addClass("br-active")[g]().addClass("br-active");l.trigger("ratingchange",[m.attr("data-rating-value"),m.attr("data-rating-text")])}});l.on({mouseleave:function(){h.removeClass("br-active");l.trigger("ratingchange").trigger("updaterating")}})}}i.hide()}};this.clear=function(){var f=d(this.elem);var g=f.next(".br-widget");if(g&&f.data("barrating")){g.find("a").removeClass("br-selected br-current");f.data("barrating").currentRatingValue=f.data("barrating").originalRatingValue;f.data("barrating").currentRatingText=f.data("barrating").originalRatingText;g.trigger("ratingchange").trigger("updaterating");this.options.onClear.call(this,f.data("barrating").currentRatingValue,f.data("barrating").currentRatingText)}};this.destroy=function(){var g=d(this.elem);var i=g.next(".br-widget");if(i&&g.data("barrating")){var f=g.data("barrating").currentRatingValue;var h=g.data("barrating").currentRatingText;g.removeData("barrating");i.off().remove();g.show();this.options.onDestroy.call(this,f,h)}}}e.prototype.init=function(g,h){var f;f=this;f.elem=h;return f.options=d.extend({},d.fn.barrating.defaults,g)};return e})();d.fn.barrating=function(f,e){return this.each(function(){var g=new b();if(!d(this).is("select")){d.error("Sorry, this plugin only works with select fields.")}if(g.hasOwnProperty(f)){g.init(e,this);return g[f]()}else{if(typeof f==="object"||!f){e=f;g.init(e,this);return g.show()}else{d.error("Method "+f+" does not exist on jQuery.barrating")}}})};return d.fn.barrating.defaults={initialRating:null,showValues:false,showSelectedRating:true,reverse:false,readonly:false,onSelect:function(e,f){},onClear:function(e,f){},onDestroy:function(e,f){}}})(jQuery);