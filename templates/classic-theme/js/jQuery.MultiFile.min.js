window.jQuery&&function(e){"use strict";function i(e){return e>1048576?(e/1048576).toFixed(1)+"Mb":1024==e?"1Mb":(e/1024).toFixed(1)+"Kb"}function t(e){return(e.files&&e.files.length?e.files:null)||[{name:e.value,size:0,type:((e.value||"").match(/[^\.]+$/i)||[""])[0]}]}e.fn.MultiFile=function(a){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var l=arguments;return this.each(function(){e.fn.MultiFile.apply(e(this),l)})}return e.fn.MultiFile[arguments[0]].apply(this,e.makeArray(arguments).slice(1)||[])}"number"==typeof a&&(a={max:a});var a=e.extend({},e.fn.MultiFile.options,a||{});e("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(e.fn.MultiFile.disableEmpty),e.fn.MultiFile.options.autoIntercept&&(e.fn.MultiFile.intercept(e.fn.MultiFile.options.autoIntercept),e.fn.MultiFile.options.autoIntercept=null),this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var l=window.MultiFile,n={e:this,E:e(this),clone:e(this).clone()},r=e.extend({},e.fn.MultiFile.options,a||{},(e.metadata?n.E.metadata():e.meta?n.E.data():null)||{},{});r.max>0||(r.max=n.E.attr("maxlength")),r.max>0||(r.max=(String(n.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.max=r.max>0?String(r.max).match(/[0-9]+/gi)[0]:-1),r.max=new Number(r.max),r.accept=r.accept||n.E.attr("accept")||"",r.accept||(r.accept=n.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",r.accept=new String(r.accept).replace(/^(accept|ext)\-/i,"")),r.maxsize=r.maxsize>0?r.maxsize:n.E.data("maxsize")||0,r.maxsize>0||(r.maxsize=(String(n.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.maxsize=r.maxsize>0?String(r.maxsize).match(/[0-9]+/gi)[0]:-1),r.maxfile=r.maxfile>0?r.maxfile:n.E.data("maxfile")||0,r.maxfile>0||(r.maxfile=(String(n.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.maxfile=r.maxfile>0?String(r.maxfile).match(/[0-9]+/gi)[0]:-1),r.maxfile>1&&(r.maxfile=1024*r.maxfile),r.maxsize>1&&(r.maxsize=1024*r.maxsize),r.max>1&&n.E.attr("multiple","multiple").prop("multiple",!0),e.extend(n,r||{}),n.STRING=e.extend({},e.fn.MultiFile.options.STRING,n.STRING),e.extend(n,{n:0,slaves:[],files:[],instanceKey:n.e.id||"MultiFile"+String(l),generateID:function(e){return n.instanceKey+(e>0?"_F"+String(e):"")},trigger:function(i,a,l,n){var r,s=l[i]||l["on"+i];return s?(n=n||l.files||t(this),e.each(n,function(e,i){r=s.apply(l.wrapper,[a,i.name,l,i])}),r):void 0}}),String(n.accept).length>1&&(n.accept=n.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),n.rxAccept=new RegExp("\\.("+(n.accept?n.accept:"")+")$","gi")),n.wrapID=n.instanceKey,n.E.wrap('<div class="MultiFile-wrap" id="'+n.wrapID+'"></div>'),n.wrapper=e("#"+n.wrapID),n.e.name=n.e.name||"file"+l+"[]",n.list||(n.wrapper.append('<div class="MultiFile-list" id="'+n.wrapID+'_list"></div>'),n.list=e("#"+n.wrapID+"_list")),n.list=e(n.list),n.addSlave=function(a,r){n.n++,a.MultiFile=n,a.id=a.name="",a.id=n.generateID(r),a.name=String(n.namePattern.replace(/\$name/gi,e(n.clone).attr("name")).replace(/\$id/gi,e(n.clone).attr("id")).replace(/\$g/gi,l).replace(/\$i/gi,r));var s;n.max>0&&n.files.length>n.max&&(a.disabled=!0,s=!0),n.current=a,a=e(a),a.val("").attr("value","")[0].value="",a.addClass("MultiFile-applied"),a.change(function(){e(this).blur();var l=this,s=n.files||[],c=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],o=[],u=0,p=n.total_size||0,m=[];e.each(c,function(e,i){o[o.length]=i}),n.trigger("FileSelect",this,n,o),e.each(c,function(a,r){var s=r.name,c=r.size,o=function(e){return e.replace("$ext",String(s.match(/[^\.]+$/i)||"")).replace("$file",s.match(/[^\/\\]+$/gi)).replace("$size",i(c)+" > "+i(n.maxfile))};n.accept&&s&&!s.match(n.rxAccept)&&(m[m.length]=o(n.STRING.denied),n.trigger("FileInvalid",this,n,[r])),e(n.wrapper).find("input[type=file]").not(l).each(function(){e.each(t(this),function(e,i){if(i.name){var t=(i.name||"").replace(/^C:\\fakepath\\/gi,"");(s==t||s==t.substr(t.length-s.length))&&(m[m.length]=o(n.STRING.duplicate),n.trigger("FileDuplicate",l,n,[i]))}})}),n.maxfile>0&&c>0&&c>n.maxfile&&(m[m.length]=o(n.STRING.toobig),n.trigger("FileTooBig",this,n,[r]));var p=n.trigger("FileValidate",this,n,[r]);p&&""!=p&&(m[m.length]=o(p)),u+=r.size}),p+=u,o.size=u,o.total=p,o.total_length=o.length+s.length,n.max>0&&s.length+c.length>n.max&&(m[m.length]=n.STRING.toomany.replace("$max",n.max),n.trigger("FileTooMany",this,n,o)),n.maxsize>0&&p>n.maxsize&&(m[m.length]=n.STRING.toomuch.replace("$size",i(p)+" > "+i(n.maxsize)),n.trigger("FileTooMuch",this,n,o));var f=e(n.clone).clone();return f.addClass("MultiFile"),m.length>0?(n.error(m.join("\n\n")),n.n--,n.addSlave(f[0],r),a.parent().prepend(f),a.remove(),!1):(n.total_size=p,c=s.concat(o),c.size=p,c.size_label=i(p),n.files=c,e(this).css({position:"absolute",top:"-3000px"}),a.after(f),n.addSlave(f[0],r+1),n.addToList(this,r,o),void n.trigger("afterFileSelect",this,n,o))}),e(a).data("MultiFile-wrap",n.wrapper),e(n.wrapper).data("MultiFile",n),s&&e(a).attr("disabled","disabled").prop("disabled",!0)},n.addToList=function(a,l,r){n.trigger("FileAppend",a,n,r);var s=e("<span/>");e.each(r,function(t,l){var r=String(l.name||""),c=n.STRING,o=c.label||c.file||c.name,u=c.title||c.tooltip||c.selected,p='<img class="MultiFile-preview" style="'+n.previewCss+'"/>',m=e(('<span class="MultiFile-label" title="'+u+'"><span class="MultiFile-title">'+o+"</span>"+(n.preview||e(a).is(".with-preview")?p:"")+"</span>").replace(/\$(file|name)/gi,(r.match(/[^\/\\]+$/gi)||[r])[0]).replace(/\$(ext|extension|type)/gi,(r.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(l.size||0)).replace(/\$(preview)/gi,p).replace(/\$(i)/gi,t));m.find("img.MultiFile-preview").each(function(){var e=this,i=new FileReader;i.readAsDataURL(l),i.onload=function(i){e.src=i.target.result}}),t>1&&s.append(", "),s.append(m);var r=String(l.name||"");s[s.length]=('<span class="MultiFile-title" title="'+n.STRING.selected+'">'+n.STRING.file+"</span>").replace(/\$(file|name)/gi,(r.match(/[^\/\\]+$/gi)||[r])[0]).replace(/\$(ext|extension|type)/gi,(r.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(l.size||0)).replace(/\$(i)/gi,t)});var c=e('<div class="MultiFile-label"></div>'),o=e('<a class="MultiFile-remove" href="#'+n.wrapID+'">'+n.STRING.remove+"</a>").click(function(){var l=t(a);n.trigger("FileRemove",a,n,l),n.n--,n.current.disabled=!1,e(a).remove(),e(this).parent().remove(),e(n.current).css({position:"",top:""}),e(n.current).reset().val("").attr("value","")[0].value="";var r=[],s=0;return e(n.wrapper).find("input[type=file]").each(function(){e.each(t(this),function(e,i){i.name&&(r[r.length]=i,s+=i.size)})}),n.files=r,n.total_size=s,n.size_label=i(s),e(n.wrapper).data("MultiFile",n),n.trigger("afterFileRemove",a,n,l),n.trigger("FileChange",n.current,n,r),!1});n.list.append(c.append(o," ",s)),n.trigger("afterFileAppend",a,n,r),n.trigger("FileChange",a,n,n.files)},n.MultiFile||n.addSlave(n.e,0),n.n++})},e.extend(e.fn.MultiFile,{data:function(){var i=e(this),t=i.is(".MultiFile-wrap"),a=t?i:i.data("MultiFile-wrap");if(!a||!a.length)return!console.error("Could not find MultiFile control wrapper");var l=a.data("MultiFile");return l?l||{}:!console.error("Could not find MultiFile data in wrapper")},reset:function(){var i=this.MultiFile("data");return i&&e(i.list).find("a.MultiFile-remove").click(),e(this)},files:function(){var e=this.MultiFile("data");return e?e.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var e=this.MultiFile("data");return e?e.total_size||0:!console.log("MultiFile plugin not initialized")},count:function(){var e=this.MultiFile("data");return e?e.files?e.files.length||0:0:!console.log("MultiFile plugin not initialized")},disableEmpty:function(i){i=("string"==typeof i?i:"")||"mfD";var t=[];return e("input:file.MultiFile").each(function(){""==e(this).val()&&(t[t.length]=this)}),window.clearTimeout(e.fn.MultiFile.reEnableTimeout),e.fn.MultiFile.reEnableTimeout=window.setTimeout(e.fn.MultiFile.reEnableEmpty,500),e(t).each(function(){this.disabled=!0}).addClass(i)},reEnableEmpty:function(i){return i=("string"==typeof i?i:"")||"mfD",e("input:file."+i).removeClass(i).each(function(){this.disabled=!1})},intercepted:{},intercept:function(i,t,a){var l,n;if(a=a||[],a.constructor.toString().indexOf("Array")<0&&(a=[a]),"function"==typeof i)return e.fn.MultiFile.disableEmpty(),n=i.apply(t||window,a),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n;i.constructor.toString().indexOf("Array")<0&&(i=[i]);for(var r=0;r<i.length;r++)l=i[r]+"",l&&function(i){e.fn.MultiFile.intercepted[i]=e.fn[i]||function(){},e.fn[i]=function(){return e.fn.MultiFile.disableEmpty(),n=e.fn.MultiFile.intercepted[i].apply(this,arguments),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n}}(l)}}),e.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,namePattern:"$name",preview:!1,previewCss:"max-height:100px; max-width:100px;",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toomany:"Too many files selected (max: $max)",toobig:"$file is too big (max $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(e){"undefined"!=typeof console&&console.log(e),alert(e)}},e.fn.reset=e.fn.reset||function(){return this.each(function(){try{this.reset()}catch(e){}})},e(function(){e("input[type=file].multi").MultiFile()})}(jQuery);